# AGENT DRIVEN DEVELOPMENT (ADD) 2.0 PROTOCOL
# For Claude Code CLI

version: 2.0.0
updated: 2026-01-06
tool: claude-code

## CLAUDE CODE CONFIGURATION

This file configures Claude Code CLI to follow ADD 2.0 Universal methodology.

## CRITICAL RULES

1. NEVER create/edit files outside project directory
2. ALWAYS request permission before installations/commands
3. ALWAYS use Git for file operations
4. ALWAYS read project documentation at session start
5. NEVER skip initialization sequence
6. NEVER commit across different phases
7. ALWAYS validate exit criteria before advancing
8. ALWAYS follow contracts in BUILD phase

## INITIALIZATION SEQUENCE

**Every Claude Code session should start with:**

```bash
# 1. Verify Git
git status

# 2. Read project configuration
cat add-project.yaml

# 3. Read current phase docs
cat docs/discovery.md docs/design.md docs/journal.md

# 4. Check contracts (if BUILD/VALIDATE)
cat docs/interfaces.md

# 5. Identify role
# Check add-project.yaml for: which agent am I? what's my context?
```

## TOOL USE PROTOCOL

Claude Code has access to these tools:

### filesystem
- Read project files
- Write code/documentation
- Respect context_dirs from add-project.yaml

### bash
- Run git commands
- Execute tests
- Install dependencies (with permission)
- Deploy (with permission)

### web_search (if configured)
- Research during DISCOVER phase
- Find documentation
- Market analysis

## PHASES (ADD 2.0)

### v0.1.x - DISCOVER
**Your role**: Research and analysis

**Tools to use**:
- web_search: Research problem domain
- filesystem: Document findings

**Commands**:
```bash
# Create discovery documentation
cat > docs/discovery.md << 'EOF'
# Problem Discovery

## Problem Statement
[Document problem]

## Context
[Document context]

## Requirements
[List requirements]
EOF

git add docs/discovery.md
git commit -m "discover: document problem and requirements"
```

**Exit criteria**:
- [ ] Problem documented
- [ ] Requirements prioritized
- [ ] Stakeholders identified
- [ ] Feasibility confirmed

---

### v0.2.x - DESIGN
**Your role**: Design solution and define contracts

**Critical**: If you'll have parallel agents in BUILD, define ALL contracts now.

**Tools to use**:
- filesystem: Create design docs and contracts

**Commands**:
```bash
# Create contracts
cat > docs/interfaces.md << 'EOF'
# Interface Contracts

## API Contracts

### POST /api/users
Input:
  name: string (required)
  email: string (required, email format)

Output:
  id: uuid
  name: string
  email: string
  created_at: datetime

Errors:
  400: Invalid input
  409: Email already exists

## Component Contracts

### LoginForm
Props:
  onSubmit: (data: {email, password}) => Promise<void>
  loading: boolean
  error: string | null

Events:
  success: {user: User}
  error: {message: string}
EOF

git add docs/interfaces.md
git commit -m "design: define contracts for BUILD phase"
```

**Exit criteria**:
- [ ] Complete design documented
- [ ] ALL contracts defined
- [ ] Architecture validated
- [ ] Design approved

---

### v0.3.x - PREPARE
**Your role**: Setup environment and tools

**Tools to use**:
- bash: Install dependencies, configure tools
- filesystem: Create configuration files

**Commands**:
```bash
# Example: Setup Node.js project
npm init -y
npm install express typescript jest

# Create tsconfig.json
cat > tsconfig.json << 'EOF'
{
  "compilerOptions": {
    "target": "ES2020",
    "module": "commonjs",
    "strict": true
  }
}
EOF

# Setup tests
mkdir -p tests
cat > tests/setup.ts << 'EOF'
// Test setup
EOF

git add package.json tsconfig.json tests/
git commit -m "prepare: setup Node.js project with TypeScript and Jest"
```

**Exit criteria**:
- [ ] Environment working
- [ ] Tools configured
- [ ] Tests can run
- [ ] Team can work

---

### v0.4.x - BUILD
**Your role**: Implement according to contracts

**⚠️ CRITICAL - CONTRACT-FIRST**:
1. Read docs/interfaces.md FIRST
2. Implement EXACTLY as specified
3. Use mocks for dependencies
4. Commit often

**If you're a specific agent** (check add-project.yaml):

```yaml
# Example from add-project.yaml
agents:
  - id: "backend_dev"
    context_dirs: ["src/backend/", "docs/"]
    # THIS IS YOU - work only in these dirs
```

**Tools to use**:
- filesystem: Implement code
- bash: Run tests

**Commands**:
```bash
# Read contracts first
cat docs/interfaces.md

# Implement to contract
cat > src/backend/users.ts << 'EOF'
import { Request, Response } from 'express';

// Implementation follows contract from docs/interfaces.md
export async function createUser(req: Request, res: Response) {
  // Input validation (contract requirement)
  const { name, email } = req.body;

  if (!name || !email) {
    return res.status(400).json({ error: 'name and email required' });
  }

  // Email format validation (contract requirement)
  if (!isValidEmail(email)) {
    return res.status(400).json({ error: 'invalid email format' });
  }

  // Create user
  const user = await db.users.create({ name, email });

  // Output format (contract requirement)
  return res.status(201).json({
    id: user.id,
    name: user.name,
    email: user.email,
    created_at: user.created_at
  });
}
EOF

# Test it
npm test

# Commit
git add src/backend/users.ts
git commit -m "build(api): implement POST /api/users (contract compliant)

Follows contract from docs/interfaces.md:
- Input validation: name, email required
- Email format validation
- Output format: id, name, email, created_at
- Error handling: 400 for invalid input

Tests: passing"
```

**If working with other agents**:
```bash
# Use mocks for their code
cat > src/frontend/api-mock.ts << 'EOF'
// Mock API based on contracts
export const mockAPI = {
  createUser: async (data) => ({
    id: 'mock-uuid',
    ...data,
    created_at: new Date().toISOString()
  })
};
EOF

# Later, when their code is ready:
# Replace mock with real API client
```

**Exit criteria**:
- [ ] All components implemented
- [ ] Contracts fulfilled
- [ ] Integration successful
- [ ] Basic validation passed

---

### v0.5.x - VALIDATE
**Your role**: Test and validate

**Tools to use**:
- bash: Run comprehensive tests
- filesystem: Document results

**Commands**:
```bash
# Run all tests
npm test

# Run integration tests
npm run test:integration

# Check coverage
npm run test:coverage

# Document results
cat > docs/validation-report.md << 'EOF'
# Validation Report

## Tests Run
- Unit tests: 45/45 passing
- Integration tests: 12/12 passing
- Coverage: 87%

## Requirements Validation
✅ All requirements from docs/requirements.md met

## Issues Found
None

## Sign-off
Ready for delivery
EOF

git add docs/validation-report.md
git commit -m "validate: comprehensive testing complete, all passing"
```

**Exit criteria**:
- [ ] All tests passing
- [ ] Requirements validated
- [ ] Quality gates passed
- [ ] Stakeholder approval

---

### v0.6.x - DELIVER
**Your role**: Deploy and launch

**Tools to use**:
- bash: Deployment commands
- filesystem: Configuration

**Commands**:
```bash
# Build production
npm run build

# Deploy (with permission!)
# Ask user: "Ready to deploy to production?"
npm run deploy:production

# Setup monitoring
# Configure monitoring tools

# Document
cat > docs/deployment.md << 'EOF'
# Deployment Log

Date: 2026-01-06
Version: v0.6.0
Environment: Production

URL: https://myapp.com
Status: LIVE ✅

Monitoring: https://monitoring.myapp.com
EOF

git add docs/deployment.md
git commit -m "deliver: deployed v0.6.0 to production"
git tag v0.6.0
git push origin v0.6.0
```

**Exit criteria**:
- [ ] Deployed
- [ ] Monitoring active
- [ ] Stakeholders notified
- [ ] Initial validation successful

---

### v0.7.x - SUPPORT
**Your role**: Monitor and fix issues

**Tools to use**:
- bash: Investigate logs, deploy hotfixes
- filesystem: Bug fixes

**Commands**:
```bash
# Investigate issue
git checkout main
git checkout -b hotfix/v1.0.1-critical-bug

# Fix
cat > src/backend/auth.ts << 'EOF'
// Security fix for authentication bypass
EOF

# Test
npm test

# Deploy hotfix
git commit -m "fix(security): patch authentication bypass vulnerability"
git tag v1.0.1
git push origin v1.0.1

# Deploy
npm run deploy:production

# Document
echo "## 2026-01-06: Security hotfix v1.0.1
- Issue: Authentication bypass
- Impact: Critical
- Resolution: Patched in v1.0.1
- Deployed: 10 minutes after detection
" >> docs/support-log.md

git add docs/support-log.md
git commit -m "support: document hotfix v1.0.1"
```

**Exit criteria**:
- [ ] No critical incidents
- [ ] All incidents resolved < SLA
- [ ] Performance stable

---

### v0.8.x - EVOLVE
**Your role**: Optimize and plan next version

**Tools to use**:
- bash: Profiling, optimization
- filesystem: Refactoring, roadmap

**Commands**:
```bash
# Profile performance
npm run profile

# Optimize
# Implement optimizations

# Plan next version
cat > docs/evolution-plan.md << 'EOF'
# Evolution Plan for v2.0.0

## Performance Improvements
- Database query optimization: 40% faster
- Caching layer: 60% fewer API calls

## New Features Planned
- Social login
- Real-time notifications
- Advanced analytics

## Technical Debt
- Refactor authentication layer
- Update dependencies
- Improve test coverage to 95%

## Timeline
Q2 2026: v2.0.0 release
EOF

git add docs/evolution-plan.md
git commit -m "evolve: plan v2.0.0 roadmap"
```

**Exit criteria**:
- [ ] Optimizations complete
- [ ] Technical debt addressed
- [ ] Roadmap defined

---

## MULTI-AGENT COORDINATION WITH CLAUDE CODE

**If using Claude Agent SDK for parallel agents:**

```python
# coordinator.py
from claude_agent import Agent, Coordinator
import asyncio

# Define agents
backend = Agent(
    name="backend",
    role="Backend developer",
    tools=["filesystem", "bash"],
    context_dirs=["src/backend/", "docs/"],
    config_file=".clauderc"  # This file!
)

frontend = Agent(
    name="frontend",
    role="Frontend developer",
    tools=["filesystem", "bash"],
    context_dirs=["src/frontend/", "docs/"],
    config_file=".clauderc"
)

# Coordinator
coord = Coordinator(agents=[backend, frontend])

# Execute BUILD phase with contract-first
async def build_phase():
    # All agents read contracts first
    contracts = await load_contracts("docs/interfaces.md")

    # Execute in parallel
    results = await asyncio.gather(
        backend.run("Implement API per contracts"),
        frontend.run("Implement UI per contracts")
    )

    # Integrate
    integration = await integrate_results(results)

    return integration

asyncio.run(build_phase())
```

## COMMIT MESSAGE FORMAT

```bash
git commit -m "type(scope): brief description

Optional longer description:
- What changed
- Why
- Breaking changes

Following ADD 2.0 phase: [PHASE_NAME]
Contract compliance: [Yes/No/N/A]
Tests: [passing/failing/N/A]"
```

**Types**: discover, design, prepare, build, validate, deliver, support, evolve, docs, chore

## MODEL CONTEXT PROTOCOL (MCP)

If using MCP servers, configure:

```json
{
  "mcpServers": {
    "filesystem": {
      "command": "mcp-server-filesystem",
      "args": ["--allowed-dirs", "src/", "docs/", "tests/"]
    },
    "git": {
      "command": "mcp-server-git"
    }
  }
}
```

## SAFETY CHECKS

Before destructive operations:

```bash
# Before delete
ls -la [target]  # Verify what will be deleted

# Before deployment
npm test  # Ensure tests pass
git status  # Verify clean state
git log -3  # Check recent commits

# Before major changes
git branch backup-$(date +%Y%m%d)  # Create backup branch
```

## EXIT CRITERIA VALIDATION

**Built-in validation script:**

```bash
# validate-phase.sh
#!/bin/bash

PHASE=$(grep "version:" add-project.yaml | cut -d'"' -f2)

case $PHASE in
  0.1.*)
    echo "Validating DISCOVER phase..."
    [ -f docs/discovery.md ] && echo "✅ discovery.md exists" || echo "❌ discovery.md missing"
    [ -f docs/requirements.md ] && echo "✅ requirements.md exists" || echo "❌ requirements.md missing"
    ;;
  0.2.*)
    echo "Validating DESIGN phase..."
    [ -f docs/design.md ] && echo "✅ design.md exists" || echo "❌ design.md missing"
    [ -f docs/interfaces.md ] && echo "✅ interfaces.md exists" || echo "❌ interfaces.md missing"
    ;;
  # ... more phases
esac
```

## BEST PRACTICES FOR CLAUDE CODE CLI

1. **Always read context first**:
   ```bash
   cat README.md docs/*.md add-project.yaml
   ```

2. **Use tool use efficiently**:
   - Combine related file operations
   - Read before write
   - Validate after changes

3. **Clear communication**:
   ```
   "I'm about to [ACTION]. This will [IMPACT].
   Current phase: [PHASE]
   Exit criteria status: [STATUS]
   Proceed?"
   ```

4. **Atomic commits**:
   - One logical change per commit
   - Clear messages
   - Linked to phase

5. **Documentation first**:
   - Document before implementing
   - Update docs when changing code
   - Keep journal.md current

## REFERENCE

- Full ADD 2.0: /var/add/ADD-UNIVERSAL.md
- Multi-Agent: /var/add/agentes/COORDINACION-PARALELA.md
- Framework: /var/add/FRAMEWORK-DESIGN.md
- Migration: /var/add/MIGRACION-1.0-A-2.0.md

---

**Version**: 2.0.0 for Claude Code
**CLI-Optimized**: Yes
**Multi-Agent Ready**: Yes (with Claude Agent SDK)
